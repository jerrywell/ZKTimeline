<!doctype html>
<html>
	<style type="text/css">
		.timeline{
			width: 1800px;
			height: 200px;
			border: 1px #E5E5E5 solid;
			z-index: 100;
			position: relative;
			overflow: hidden;
		}

		.timeline .content{
			left: 100px;
			position: relative;
		}

		.timeline .content-cave{
			height: 150px;
		}

		.timeline .small-facet{
			width: 5000px;
			height: 5px;
			background-image: url("small-facet.png");
			background-repeat: repeat;
		}

		.timeline .event{
			height: 150px;
			width: 150px;
			border-left: 1px #E5E5E5 solid;
			position: absolute;
		}

		.timeline .event:hover{
			border-left-color: #999999;
		}


		.timeline .text:hover{
			/*border-color: #B6B6B6;*/
			/*background-color: white;*/
			background-image: url(timeline.png?v4.4);
			background-repeat: no-repeat;
			background-position: 0 -53px;
			color: #0088CC;
		}

		.timeline .text{
			height: 50px;
			width: 153px;
			/*border: 1px #D8D8D8 solid;*/
			margin: 0px;
			background-image: url(timeline.png?v4.4);
			background-repeat: no-repeat;
			background-position: 0 0;
			/*background-color: #EFEFEF;*/
			color: #9999A3;
			text-align: center;
			-webkit-border-radius: 2px;  
			-moz-border-radius: 2px;  
			border-radius: 2px;  
		}

		.timeline .facet{
			margin-top: 5px;
			position: absolute;
			text-indent: -10px;
			font-weight: normal;
			font-size: 10px;
			color: #666;
			font-size: 11px;
			line-height: 11px;
			font-weight: bold;
		}

		.timeline .facet-inner{
			background: url("small-facet.png") repeat-y ;
			height: 10px;
			width: 100%;
		}

		.timeline .background{
			position: absolute;
			top: 0px;
		}

		.timeline .line{
			left:898px;
			height: 150px;
			width: 4px;
			background-color: #08c; 
			position: absolute;
			z-index: 1;
		}

		.timeline .indicator{
			z-index: 2;
			position: absolute;
			left: 888px;
			width: 24px;
			height: 24px;
			background-image: url(timeline.png?v4.4);
			background-repeat: no-repeat;
			background-position: -160px -48px;
		}
	</style>
	<script type="text/javascript" src="jquery-1.11.1.js"></script>

	<body>
		<div class="timeline">
			<div class="content">
				<div class="content-cave">
					<!-- <div class="event"><div class="text"></div></div> -->
				</div>
				<div class="small-facet"></div>
				<div class="large-facet">
					<!-- <div class="facet"><div class="facet-inner"></div><div></div></div> -->
				</div>
			</div>
			<div class="background">
				<div class="indicator"></div>
				<div class="line"></div>
			</div>
		</div>
	</body>

	<script type="text/javascript">
(function(){

	function TimelineFacet(config) {
		var _safePx = 70,
			_formatter = [
				function(date) { return date.getYear();},
				function(date) { return date.getMonth();},
				function(date) { return (date.getMonth()+1) + '/' + date.getDate();},
				function(date) { return date.getHours();},
				function(date) { return date.getMinutes();},
				function(date) { return date.getSeconds();},
				function(date) { return date.getMilliseconds();}
			],
			period = config.period,
			pivote = config.pivote,
			periodOffset = config.periodOffset,
			unit = config.unit,
			width = config.width,
			height = config.height;

		return {
			getDistanceFromStart: function(facetTime, realWidth) {
				return Math.abs(facetTime.getTime() - this.getStartTime()) / this.getMillisecondsPerPx(realWidth);
			},
			getDistance: function(startTime, facetTime, realWidth) {
				return Math.abs(facetTime.getTime() - startTime.getTime()) / this.getMillisecondsPerPx(realWidth);
			},
			getNextFacet: function(startTime) {
				var leftPx = -1,
					facetTime = new Date(startTime),
					facetTimeArr = [];

				switch(unit + 1) {
					case 2:
						facetTime.setMonth(1);
					case 3:
						facetTime.setDate(1);
					case 4: 
						facetTime.setHours(0);
					case 5: 
						facetTime.setMinutes(0);
					case 6: 
						facetTime.setSeconds(0);
					case 7: 
						facetTime.setMilliseconds(0);
				}

				facetTimeArr = [facetTime.getFullYear(), facetTime.getMonth(), facetTime.getDate(),
					facetTime.getHours(), facetTime.getMinutes(), facetTime.getSeconds(), facetTime.getMilliseconds()];

				facetTimeArr[unit - 1] = facetTimeArr[unit - 1] + 1;

				return new Date(facetTimeArr[0], facetTimeArr[1], facetTimeArr[2], facetTimeArr[3], facetTimeArr[4], facetTimeArr[5], facetTimeArr[6]);
			},
			getMillisecondsPerPx: function(realWidth) {
				return period / realWidth;
			},
			getSafeMs: function() {
				return getMilisecondsPerPx * _safePx;
			},
			getStartTime: function() {
				return new Date(pivote - periodOffset);
			},
			getEndTime: function() {
				return new Date(this.getStartTime().getTime() + periodOffset);
			},
			getMiddleTime: function() {
				var start = getStartTime().getTime();
				return new Date((getEndTime().getTime() - start)/2 + start);
			},
			formatDate: function(date) {
				return _formatter[unit - 1](date);
			}
		};
	}

	function TimelineEvent(config) {
		return {
			sort: function(events) {
				events.sort(function(e1, e2) {
					var start1 = e1.start.getTime(),
						start2 = e2.start.getTime(),
						end1 = e1.end.getTime(),
						end2 = e2.end.getTime();

					if(start1 != start2)
						return start1 - start2;
					else
						return end1 - end2;
				});
			}
		};
	}

	function init() {
		var timeData = config.data,
			events = [],
			length = timeData.length;

		_minDate = _maxDate = timeData[length - 1];
		events.push($.extend({}, timeData[length - 1]));
		// bulid event
		for (var i = timeData.length - 2; i >= 0; i--) {
			var obj = $.extend({}, timeData[i]),
				start = obj.start,
				end = obj.end;

			events.push(obj);
			if(_maxDate < end) maxDate = end;
			if(_minDate > start) minDate = start;

		}

		buildFacet();
		buildEvent(events);
	}

	function buildFacet() {
		var start = _timelineFacet.getStartTime(),
			date = new Date(config.pivote),
			width = 0,
			dom = '';

		for (var i = 1; i < 20; i++) {
			date = _timelineFacet.getNextFacet(date);
			width = _timelineFacet.getDistance(start, date, _realWidth);

			dom += '<div class="facet" style="left:' + width + 'px"><div class="facet-inner"></div><div>' + _timelineFacet.formatDate(date) + '</div></div>';
		}

		$('.large-facet').append(dom);
	}

	function buildEvent(events) {
		var html = '';
		for(var i = 0, length = events.length; i < length; i++) {
			var event = events[i];
			html += '<div class="event" style="left:' + _timelineFacet.getDistanceFromStart(event.start, _realWidth) + 'px"><div class="text">' + event.title + '</div></div>'
		}

		$('.content-cave').append(html);
	}

	var _year = 1,
		_month = 2,
		_day = 3,
		_hour = 4,
		_minute = 5,
		_second = 6,
		_millisecond = 7,
		_maxDate,
		_minDate,
		_realWidth = 1920,
		config = {
			width: '100%',
			height: '300px',
			eventWidth: 150,
			eventHeight: 40,
			period: 604800000,
			pivote: new Date('2014/6/6 00:00:00').getTime(),
			periodOffset: 0,
			unit: _day,
			data:[
				{
					start: new Date('2014/6/6 12:00:00'),
					end: new Date('2014/6/7 2:00:00'),
					title: 'test1'
				},
				{
					start: new Date('2014/6/8 0:00:00'),
					end: new Date('2014/6/9 0:00:00'),
					title: 'test2'
				}
			]
		},
		_timelineFacet = new TimelineFacet(config),
		_timelineEvent = new TimelineEvent(config);

	init();
	
})();
	</script>
</html>