imageslider.ImageSlider=zk.$extends(zul.Widget,{_scrollIndex:0,_viewportSize:3,_selectedIndex:-1,_imageWidth:200,_doubleBorderWidth:4,_shouldResize:false,$define:{scrollIndex:function(){if(this.desktop){this.updateScroll_()}},viewportSize:function(){if(this.desktop){this.updateContent_();this.updateArrow_()}},imageWidth:function(){if(this.desktop){jq(this).height(this._imageWidth);this.updateContent_();this.updateCave_();this.updatePhotos_();this.updateScroll_()}}},getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(f,e){var d=this._selectedIndex,c=this._selectedIndex=f;if(this.desktop){var b=this._scrollIndex,a=this._viewportSize;if(c!=-1){this.updateFocus_(d,this.getChildAt(c));if(c<b){this.setScrollIndex(c)}else{if(c>(b+a-1)){this.setScrollIndex(c-a+1)}}}}},bind_:function(){this.$supers(imageslider.ImageSlider,"bind_",arguments);this.domListen_(this.$n("next"),"onClick","_doNextClick").domListen_(this.$n("previous"),"onClick","_doPreviousClick");zWatch.listen({onResponse:this})},unbind_:function(){this.domUnlisten_(this.$n("next"),"onClick","_doNextClick").domUnlisten_(this.$n("previous"),"onClick","_doPreviousClick");zWatch.unlisten({onResponse:this});this.$supers(imageslider.ImageSlider,"unbind_",arguments)},onResponse:function(){if(this._shouldResize){this.updateCave_();this.updateArrow_();this._shouldResize=false}},insertChildHTML_:function(d,b,c){var a=jq(this.encloseChildHTML_(d));if(b){jq(b).before(a)}else{jq(this.$n("cave")).append(a)}this._resetImageSize(a,this._imageWidth);this._shouldResize=true;d.bind(c)},encloseChildHTML_:function(b){var a=[];a.push('<div class="'+this.getZclass()+'-outer">');b.redraw(a);a.push("</div>");return a.join("")},removeChildHTML_:function(b){var a=jq(b).parent();this.$supers(imageslider.ImageSlider,"removeChildHTML_",arguments);a.remove();this._shouldResize=true},doSelect_:function(a){var d=a.target,b=-1,c=this._selectedIndex;if(d.$instanceof(zul.wgt.Image)){b=d.getChildIndex();if(b!=c){this.updateFocus_(c,d);this._selectedIndex=b;this.fire("onSelect",{index:b})}}this.$supers("doSelect_",arguments)},getCaveNode:function(){return this.$n("cave")},_doNextClick:function(a){if(this._scrollIndex<(this.nChildren-this._viewportSize)){this.setScrollIndex(this._scrollIndex+1);this.updateScroll_()}},_doPreviousClick:function(a){if(this._scrollIndex>0){this.setScrollIndex(this._scrollIndex-1);this.updateScroll_()}},_resetImageSize:function(b,a){jq(b).width(a).height(a)},updateFocus_:function(c,d){var b=this._imageWidth,a=this._doubleBorderWidth;if(c!=-1){jq(this.getChildAt(c)).parent().removeClass("z-imageslider-focus").css({width:b,height:b})}if(d){jq(d).parent().addClass("z-imageslider-focus").css({width:b-a,height:b-a})}},updateContent_:function(){var a=this._imageWidth*this._viewportSize;jq(this.$n("content")).width(a).height(this._imageWidth)},updateArrow_:function(){if(this._viewportSize>=this.nChildren){this.setScrollIndex(0);jq(this.$n("previous")).hide();jq(this.$n("next")).hide()}else{jq(this.$n("previous")).show();jq(this.$n("next")).show()}},updateCave_:function(){var c=this.nChildren,b=this._scrollIndex,a=this._viewportSize;jq(this.$n("cave")).width((this.nChildren+1)*(this._imageWidth+1));if(b>0&&c<b+a){this.setScrollIndex(c-a)}},updatePhotos_:function(){var b=this._imageWidth,e=b-this._doubleBorderWidth,a=this._selectedIndex,d=-1;for(var c=this.firstChild;c;c=c.nextSibling){d++;if(d==a){this._resetImageSize((jq(c).parent()),e)}else{this._resetImageSize(jq(c).parent(),b)}}},updateScroll_:function(){jq(this.$n("content")).animate({scrollLeft:this._scrollIndex*this._imageWidth})},getZclass:function(){return this._zclass!=null?this._zclass:"z-imageslider"}});